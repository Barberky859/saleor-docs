---
title: Checkout API Guide
sidebar_label: API Guide
---

## Creating a checkout session

:::note

A [`Checkout`](api-reference/checkout/objects/checkout.mdx) object can be created for logged-in users and for anonymous (guest) users.

:::

To create a [`Checkout`](api-reference/checkout/objects/checkout.mdx) object, use the [`checkoutCreate`](api-reference/checkout/mutations/checkout-create.mdx) mutation.

- If you call the `checkoutCreate` mutation and provide the Authorization header with a valid auth token, the created checkout will be assigned to the user who is authenticated by this token. For more information on how to authenticate with our API, see the [authentication guide](api-usage/authentication.mdx).

- If no authentication token is provided, the checkout is created for an anonymous user,
  and an email address is used to identify such a [`Checkout`](api-reference/checkout/objects/checkout.mdx) object,
  linking it with the anonymous user.
  User email is not required at this stage but must be provided before adding a promo code, creating a payment, and completing checkout.

`checkoutCreate` mutation takes the following [input](api-reference/checkout/inputs/checkout-create-input.mdx):

- `channel`: Slug of a channel in which to create checkout.
- `email`: the user's email address.
- `shippingAddress`: the shipping address (if needed).
- `billingAddress`: the billing address.
- `lines`: a list of checkout lines, each checkout line contains a product variant ID and its quantity.
- `validationRules`: the checkout validation rules that can be changed.

The resulting [`Checkout`](api-reference/checkout/objects/checkout.mdx) object contains the following fields:

- `id`: a unique checkout ID.
- `totalPrice`: the total price of the checkout lines and shipping costs.
- `isShippingRequired`: denotes whether shipping is required for this checkout.
- `availablePaymentGateways`: a list of [payment gateways](developer/payments/overview.mdx) that are currently configured on your Saleor server and can be used to pay for the checkout. Only gateways that are enabled for a given channel and support the checkout currency are returned. For each gateway, the API returns an ID, a name, and a config object, which for some gateways may return additional information required to initialize or process the payment on the front-end.
- `shippingMethods`: a list of all shipping methods for this checkout. If the items in the cart require shipment.
- `availableCollectionPoints`: a list of available places for self-pickup. It is calculated based on the given country and available Stocks (for Warehouses which `clickAndCollectOption` field is not set to `DISABLED`).

In addition, the following fields are available in the mutation results:

- `created`: a boolean flag indicating whether a new checkout object was created, or an existing one was used.
- `errors`: a list of errors that occurred during mutation execution.

The following example shows how the [`checkoutCreate`](api-reference/checkout/mutations/checkout-create.mdx) mutation creates the [`Checkout`](api-reference/checkout/objects/checkout.mdx) object and returns the checkout information:

```graphql
mutation {
  checkoutCreate(
    input: {
      channel: "default-channel"
      email: "customer@example.com"
      lines: [{ quantity: 1, variantId: "UHJvZHVjdFZhcmlhbnQ6Mjk3" }]
      shippingAddress: {
        firstName: "John"
        lastName: "Doe"
        streetAddress1: "1470  Pinewood Avenue"
        city: "Michigan"
        postalCode: "49855"
        country: US
        countryArea: "MI"
      }
      billingAddress: {
        firstName: "John"
        lastName: "Doe"
        streetAddress1: "1470  Pinewood Avenue"
        city: "Michigan"
        postalCode: "49855"
        country: US
        countryArea: "MI"
      }
    }
  ) {
    checkout {
      id
      totalPrice {
        gross {
          amount
          currency
        }
      }
      isShippingRequired
      shippingMethods {
        id
        name
        active
        message
      }
      availableCollectionPoints {
        id
        name
        clickAndCollectOption
      }
      availablePaymentGateways {
        id
        name
        config {
          field
          value
        }
      }
    }
    errors {
      field
      code
    }
  }
}
```

We get a newly created checkout object for which we receive the ID, total price, and list of available shipping and payment methods:

```json
{
  "data": {
    "checkoutCreate": {
      "checkout": {
        "id": "Q2hlY2tvdXQ6ZmE5ZjBkMjYtMWM3NC00MDgyLTk3MzktYTIxOGE2NzVjMDZk",
        "totalPrice": {
          "gross": {
            "amount": 20,
            "currency": "USD"
          }
        },
        "isShippingRequired": true,
        "shippingMethods": [
          {
            "id": "U2hpcHBpbmdNZXRob2Q6MTM=",
            "name": "UPS",
            "active": true,
            "message": ""
          },
          {
            "id": "U2hpcHBpbmdNZXRob2Q6MTI=",
            "name": "DHL",
            "active": false,
            "message": "Not available."
          }
        ],
        "availableCollectionPoints": [
          {
            "id": "V2FyZWhvdXNlOjU0NjliNWQ3LThmOGUtNGVmOS1iMGQxLWNhYWZmYTg4MjI1OQ==",
            "name": "Local Store"
            "clickAndCollectOption": "LOCAL"
          },
          {
            "id": "=V2FyZWhvdXNlOjU0NjliNWQ3LThmOGUtNGVmOS1iMGQxLWNhYWZmYTg4MjI1OA==",
            "name": "Company HQ"
            "clickAndCollectOption": "ALL"
          }
        ],
        "availablePaymentGateways": [
          {
            "id": "app.saleor.adyen",
            "name": "Adyen",
            "config": []
          }
        ]
      },
      "errors": []
    }
  }
}
```

## Checkout email

When an anonymous checkout has been created without an email, the email must be set before creating payment and completing checkout.
Use the [`CheckoutEmailUpdate`](api-reference/checkout/mutations/checkout-email-update.mdx) mutation to update checkout `email`.

The operation requires the following inputs:

- `id`: checkout ID (the `id` field of the [`Checkout`](api-reference/checkout/objects/checkout.mdx) object),
- `email`: user email.

```graphql {2-4}
mutation {
  checkoutEmailUpdate(
    id: "Q2hlY2tvdXQ6ZTEzZDFjOTItOWJkNi00ODViLTgyMDctZTNhM2I5NjVkZTQw"
    email: "test_customer@example.com"
  ) {
    checkout {
      id
      email
    }
    errors {
      field
      message
    }
  }
}
```

As a result, we get an updated checkout object with the new checkout email set:

```json {6}
{
  "data": {
    "checkoutDeliveryMethodUpdate": {
      "checkout": {
        "id": "Q2hlY2tvdXQ6ZTEzZDFjOTItOWJkNi00ODViLTgyMDctZTNhM2I5NjVkZTQw",
        "email": "test_customer@example.com"
      },
      "errors": []
    }
  }
}
```
