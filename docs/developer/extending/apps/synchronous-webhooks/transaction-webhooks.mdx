---
title: Transaction webhooks
---

# Introduction

:::caution
This feature is currently in **Feature Preview**. This part of Saleor is not complete
and subject to change but is available to experiment and provide feedback.
:::

Transaction webhooks are synchronous webhooks that allow delegating the action for transaction to Saleor App.
Synchronous means that these webhooks expect a response of a particular
shape to be returned from the App to continue processing in Saleor. Transaction webhooks only
support the HTTP(S) protocol; they are sent as POST requests with the application/json body
and expect a response of the same content type.

## Key concepts

The `HANDLE_PAYMENTS` permission is required for the App to be able to receive transaction webhooks.
The webhook notification is only sent to a specific app that is connected to given transaction.

## General transaction flow

The usage of the webhook is strictly related to the payment flow handled by transactions.
More details about whole transaction flow can be found
[here](../../../payments#saleor-app-recommended).

## Transaction charge

`TRANSACTION_CHARGE_REQUESTED`

:::info

This feature was introduced in **Saleor 3.12**.

:::

Synchronous webhook called inside celery task. Called when staff user requests the charge action.
It expects in the response at least `pspReference`. The `pspReference` will be attached to [TransactionEvent](api-reference/objects/transaction-event.mdx)
with request details. Attached `pspReference` to "request" object means that the webhook has been
successfully processed by app. Optionally the result data can be provided. The data is
used to provide the final status of the requested action, and it will be used to create a new [TransactionEvent](api-reference/objects/transaction-event.mdx)
object. The new [TransactionEvent](../../../../api-reference/objects/transaction-event.mdx) object will have provided `pspReference`, and will be used in the
[re-calculation of the transaction's amount process](../../../payments#re-calculations-of-transaction-amounts).

### Request

Saleor will send a
[TRANSACTION_CHARGE_REQUESTED](../../../../api-reference/enums/webhook-event-type-sync-enum#code-style-fontweight-normal-webhookeventtypesyncenumbtransaction_charge_requestedbcode)
webhook by using [TransactionChargeRequested](../../../../api-reference/objects/transaction-charge-requested) subscription type
or with pre-defined payload in case of missing subscription query.

You can find more details about building webhook subscription query
[here](../../../extending/apps/subscription-webhook-payloads).

The below example shows a sample webhook subscription defined to handle charge requests:

```graphql
subscription {
  event {
    __typename
    ... on TransactionChargeRequested {
      action {
        actionType
        amount
      }
      transaction {
        id
        pspReference
        authorizedAmount {
          amount
          currency
        }
        order {
          id
        }
      }
    }
  }
}
```

The below example shows the pre-defined payload that will be used in case when subscription query is not provided:

```json
{
  "action": { "currency": "USD", "type": "charge", "value": "5.00" },
  "meta": {
    "issued_at": "1914-06-28T10:50:00+00:00",
    "issuing_principal": { "id": "Sample app objects", "type": "app" },
    "version": "3.12.0-a"
  },
  "transaction": {
    "authorized_value": "10.00",
    "available_actions": ["capture", "void"],
    "canceled_value": "0.00",
    "charged_value": "0.00",
    "checkout_id": null,
    "created_at": "1914-06-28T10:50:00Z",
    "currency": "USD",
    "message": "",
    "modified_at": "1914-06-28T10:50:00Z",
    "name": "Credit card",
    "order_id": "T3JkZXI6YjE1YzdlZTgtMzUxNy00MTczLWEzNWYtMmQxMDdkMWI4Yzhk",
    "psp_reference": "PSP ref",
    "reference": "PSP ref",
    "refunded_value": "0.00",
    "status": "Authorized",
    "type": "Credit card",
    "voided_value": "0.00"
  }
}
```

### Response

#### Async flow

App needs to at least return the `pspReference` of the requested action. This is a common case
when the payment provider doesn't return a status of the requested action in the response.
In this situation, the status of the action is delivered by an asynchronous notification that
should be handled by App, and passed to Saleor by using
[transactionEventReport](../../../payments#reporting-action-for-transaction)
mutation.

The response in this case should have bellowed structure:

```json
{
  "pspReference": "<psp reference recieved from payment provider>"
}
```

#### Sync flow

The app has the possibility to immediately report the status of the requested action.
This is a common case when the payment provider returns the status of the action in
response to the requested action.
The payload response has to contain at least `pspReference`, `result` (
[CHARGE_SUCCESS](../../../../api-reference/enums/transaction-event-type-enum#code-style-fontweight-normal-transactioneventtypeenumbcharge_successbcode)
or [CHARGE_FAILURE](../../../../api-reference/enums/transaction-event-type-enum#code-style-fontweight-normal-transactioneventtypeenumbcharge_failurebcode)),
and `amount` fields.

The response in this case should have bellowed structure:

```json
{
  "pspReference": "<psp reference revieved from payment provider>",
  "result": "<CHARGE_SUCCESS or CHARGE_FAILURE>",
  "amount": "<Decimal amount of the processed action>",
  "time": "<[Optional] time of the action>",
  "externalUrl": "<[Optional] external url with action details.",
  "message": "<[Optional] message related to the action."
}
```

:::caution
In case when one of `result`, `amount` is provided and the second one is missing,
the response will not be processed, and Saleor will create the failure event.
:::

## Transaction cancellation

`TRANSACTION_CANCELATION_REQUESTED`

:::info

This feature was introduced in **Saleor 3.12**.

:::

Synchronous webhook called inside celery task. Called when staff user requests the cancel action.
It expects in the response at least `pspReference`. The `pspReference` will be attached to
[TransactionEvent](api-reference/objects/transaction-event.mdx)
with request details. Attached `pspReference` to "request" object means that the webhook has been
successfully processed by app. Optionally the result data can be provided. The data is
used to provide the final status of the requested action, and it will be used to create a new
[TransactionEvent](api-reference/objects/transaction-event.mdx) object. The new
[TransactionEvent](../../../../api-reference/objects/transaction-event.mdx) object will have
provided `pspReference`, and will be used in the
[re-calculation of the transaction's amount process](../../../payments#re-calculations-of-transaction-amounts).

### Request

Saleor will send a
[TRANSACTION_CANCEL_REQUESTED](../../../../api-reference/enums/webhook-event-type-sync-enum#code-style-fontweight-normal-webhookeventtypesyncenumbtransaction_cancelation_requestedbcode)
webhook by using [TransactionCancelationRequested](../../../../api-reference/objects/transaction-cancelation-requested) type
or with pre-defined payload in case of missing subscription query.

You can find more details about building webhook subscription query
[here](../../../extending/apps/subscription-webhook-payloads).

The below example shows a sample webhook subscription defined to handle cancelation requests:

```graphql
subscription {
  event {
    __typename
    ... on TransactionCancelationRequested {
      action {
        actionType
        amount
      }
      transaction {
        id
        pspReference
        authorizedAmount {
          amount
          currency
        }
        order {
          id
        }
      }
    }
  }
}
```

The below example shows the pre-defined payload that will be used in case when subscription query is not provided:

```json
{
  "action": { "currency": "USD", "type": "cancel", "value": "0.00" },
  "meta": {
    "issued_at": "1914-06-28T10:50:00+00:00",
    "issuing_principal": { "id": "Sample app objects", "type": "app" },
    "version": "3.12.0-a"
  },
  "transaction": {
    "authorized_value": "10.00",
    "available_actions": ["capture", "void"],
    "canceled_value": "0.00",
    "charged_value": "0.00",
    "checkout_id": null,
    "created_at": "1914-06-28T10:50:00Z",
    "currency": "USD",
    "message": "",
    "modified_at": "1914-06-28T10:50:00Z",
    "name": "Credit card",
    "order_id": "T3JkZXI6YWEzYzVhOTMtN2NlYS00OGZkLWJmYWUtMWFkYjI5YTRjMmY1",
    "psp_reference": "PSP ref",
    "reference": "PSP ref",
    "refunded_value": "0.00",
    "status": "Authorized",
    "type": "Credit card",
    "voided_value": "0.00"
  }
}
```

### Response

#### Async flow

App needs to at least return the `pspReference` of the requested action. This is a common case
when the payment provider doesn't return a status of the requested action in the response.
In this situation, the status of the action is delivered by an asynchronous notification that
should be handled by App, and passed to Saleor by using
[transactionEventReport](../../../payments#reporting-action-for-transaction)
mutation.

The response in this case should have bellowed structure:

```json
{
  "pspReference": "<psp reference recieved from payment provider>"
}
```

#### Sync flow

The app has the possibility to immediately report the status of the requested action.
This is a common case when the payment provider returns the status of the action in
response to the requested action.
The payload response has to contain at least `pspReference`, `result` (
[CANCEL_SUCCESS](../../../../api-reference/enums/transaction-event-type-enum#code-style-fontweight-normal-transactioneventtypeenumbcancel_successbcode)
or [CANCEL_FAILURE](../../../../api-reference/enums/transaction-event-type-enum#code-style-fontweight-normal-transactioneventtypeenumbcancel_failurebcode)),
and `amount` fields.

The response in this case should have bellowed structure:

```json
{
  "pspReference": "<psp reference revieved from payment provider>",
  "result": "<CANCEL_SUCCESS or CANCEL_FAILURE>",
  "amount": "<Decimal amount of the processed action>",
  "time": "<[Optional] time of the action>",
  "externalUrl": "<[Optional] external url with action details.",
  "message": "<[Optional] message related to the action."
}
```

:::caution
In case when one of `result`, `amount` is provided and the second one is missing,
the response will not be processed, and Saleor will create the failure event.
:::

## Transaction refund

`TRANSACTION_REFUND_REQUESTED`

:::info

This feature was introduced in **Saleor 3.12**.

:::

Synchronous webhook called inside celery task. Called when staff user requests the refund action.
It expects in the response at least `pspReference`. The `pspReference` will be attached to [TransactionEvent](api-reference/objects/transaction-event.mdx)
with request details. Attached `pspReference` to "request" object means that the webhook has been
successfully processed by app. Optionally the result data can be provided. The data is
used to provide the final status of the requested action, and it will be used to create a new [TransactionEvent](api-reference/objects/transaction-event.mdx)
object. The new [TransactionEvent](../../../../api-reference/objects/transaction-event.mdx) object will have provided `pspReference`, and will be used in the
[re-calculation of the transaction's amount process](../../../payments#re-calculations-of-transaction-amounts).

### Request

Saleor will send a
[TRANSACTION_REFUND_REQUESTED](../../../../api-reference/enums/webhook-event-type-sync-enum#code-style-fontweight-normal-webhookeventtypesyncenumbtransaction_refund_requestedbcode)
webhook by using [TransactionRefundRequested](../../../../api-reference/objects/transaction-refund-requested) type
or with pre-defined payload in case of missing subscription query.

More details about building webhook subscription query can be found
[here](../../../extending/apps/subscription-webhook-payloads).

The below example shows a sample webhook subscription defined to handle refund requests:

```graphql
subscription {
  event {
    __typename
    ... on TransactionRefundRequested {
      action {
        actionType
        amount
      }
      transaction {
        id
        pspReference
        chargedAmount {
          amount
          currency
        }
        order {
          id
        }
      }
    }
  }
}
```

The below example shows the pre-defined payload that will be used in case when subscription query is not provided:

```json
{
  "action": { "currency": "USD", "type": "refund", "value": "9.00" },
  "meta": {
    "issued_at": "1914-06-28T10:50:00+00:00",
    "issuing_principal": { "id": "Sample app objects", "type": "app" },
    "version": "3.12.0-a"
  },
  "transaction": {
    "authorized_value": "10.00",
    "available_actions": ["capture", "void"],
    "canceled_value": "0.00",
    "charged_value": "0.00",
    "checkout_id": null,
    "created_at": "1914-06-28T10:50:00Z",
    "currency": "USD",
    "message": "",
    "modified_at": "1914-06-28T10:50:00Z",
    "name": "Credit card",
    "order_id": "T3JkZXI6NjdlYTYxNDAtMzEwZi00YTRlLThmODktNTU2NjliMjk4NjU5",
    "psp_reference": "PSP ref",
    "reference": "PSP ref",
    "refunded_value": "0.00",
    "status": "Authorized",
    "type": "Credit card",
    "voided_value": "0.00"
  }
}
```

### Response

#### Async flow

App needs to at least return the `pspReference` of the requested action. This is a common case
when the payment provider doesn't return a status of the requested action in the response.
In this situation, the status of the action is delivered by an asynchronous notification that
should be handled by App, and passed to Saleor by using
[transactionEventReport](../../../payments#reporting-action-for-transaction)
mutation.

The response in this case should have bellowed structure:

```json
{
  "pspReference": "<psp reference recieved from payment provider>"
}
```

#### Sync flow

The app has the possibility to immediately report the status of the requested action.
This is a common case when the payment provider returns the status of the action in
response to the requested action.
The payload response has to contain at least `pspReference`, `result` (
[REFUND_SUCCESS](../../../../api-reference/enums/transaction-event-type-enum#code-style-fontweight-normal-transactioneventtypeenumbrefund_successbcode)
or [REFUND_FAILURE](../../../../api-reference/enums/transaction-event-type-enum#code-style-fontweight-normal-transactioneventtypeenumbrefund_failurebcode)),
and `amount` fields.

The response in this case should have bellowed structure:

```json
{
  "pspReference": "<psp reference revieved from payment provider>",
  "result": "<REFUND_SUCCESS or REFUND_FAILURE>",
  "amount": "<Decimal amount of the processed action>",
  "time": "<[Optional] time of the action>",
  "externalUrl": "<[Optional] external url with action details.",
  "message": "<[Optional] message related to the action."
}
```

:::caution
In case when one of `result`, `amount` is provided and the second one is missing,
the response will not be processed, and Saleor will create the failure event.
:::
